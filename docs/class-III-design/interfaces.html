<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>8.5. Abstract base classes &#8212; CISC 187 Course Reader Overview</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/matrixeq.css?v=58BC228F" />
    <link rel="stylesheet" type="text/css" href="../_static/CodeChat.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/handsontable@7.2.2/dist/handsontable.full.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/webgldemo.css?v=B36B48D" />
    <link rel="stylesheet" type="text/css" href="../_static/webglinteractive.css?v=910DF1E1" />
    <link rel="stylesheet" type="text/css" href="../_static/accessibility.css?v=DB047029" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-3.4.1/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/presenter_mode.css?v=9FF1320F" />
    <link rel="stylesheet" type="text/css" href="../_static/jquery-ui-1.10.3.custom.min.css?v=97E0178A" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/user-highlights.css?v=A2326E52" />
    <link rel="stylesheet" type="text/css" href="../_static/runestone-custom-sphinx-bootstrap.css?v=5.0.8" />
    <link rel="stylesheet" type="text/css" href="../_static/theme-overrides.css?v=2DAFE138" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/pytutor-embed.bundle.js?v=268B5C04"></script>
    <script src="../_static/matrixeq.js?v=D64CFA5A"></script>
    <script src="../_static/animationbase.js?v=A043C3A7"></script>
    <script src="../_static/html4css1.css?v=4D8F3FB4"></script>
    <script src="../_static/jquery.highlight.js?v=F1C496C8"></script>
    <script src="../_static/sql-wasm.js?v=44FE0709"></script>
    <script src="https://cdn.jsdelivr.net/npm/handsontable@7.2.2/dist/handsontable.full.js"></script>
    <script src="../_static/webglinteractive.js?v=2B768384"></script>
    <script src="../_static/FileSaver.min.js?v=8408C997"></script>
    <script src="../_static/Blob.js?v=AEC2447"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.5/jquery.i18n.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.5/jquery.i18n.emitter.bidi.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.5/jquery.i18n.emitter.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.5/jquery.i18n.fallbacks.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.5/jquery.i18n.messagestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.5/jquery.i18n.parser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.5/jquery.i18n.language.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega@4.0.0-rc.2/build/vega.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@2.5.0/build/vega-lite.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@3.14.0/build/vega-embed.js"></script>
    <script src="../_static/runestone.js?v=343ECCF5"></script>
    <script src="../_static/jquery-ui-1.10.3.custom.min.js?v=2B07FE4F"></script>
    <script src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
    <script src="../_static/jquery-fix.js?v=1226591B"></script>
    <script src="../_static/bootstrap-sphinx.js"></script>
    <script src="../_static/jquery.idle-timer.js?v=E942DAF1"></script>
    <script src="../_static/presenter_mode.js?v=2DF16FB4"></script>
    <script src="../_static/theme.js?v=D899FB97"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8.6. Design patterns" href="patterns.html" />
    <link rel="prev" title="8.4. Inheritance" href="inheritance.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
<link rel="shortcut icon" href="/cisc187-reader/static/favicon.ico" type="image/ico" />

<script type="text/javascript">
  eBookConfig = {};
  
    eBookConfig.useRunestoneServices = false;
    eBookConfig.host = 'https://daveparillo.github.io/cisc187-reader/' || 'http://127.0.0.1:8000';
    eBookConfig.app = eBookConfig.host+'/cisc187-reader';
    eBookConfig.course = 'cisc187-reader';
    eBookConfig.basecourse = 'cisc187-reader';
    eBookConfig.isLoggedIn = false;
  
  eBookConfig.ajaxURL = eBookConfig.app+'/ajax/';
  eBookConfig.logLevel = 0;
  eBookConfig.loginRequired = false;
  eBookConfig.build_info = "unknown";
  eBookConfig.python3 = true;
  eBookConfig.acDefaultLanguage = 'cpp' ? 'cpp' : 'python'
  eBookConfig.runestone_version = '5.0.8';
  eBookConfig.jobehost = 'https://fierce-ridge-58946.herokuapp.com/http://jobe2.cosc.canterbury.ac.nz';
  eBookConfig.proxyuri_runs = '/jobe/index.php/restapi/runs/';
  eBookConfig.proxyuri_files = '/jobe/index.php/restapi/files/';
  eBookConfig.enable_chatcodes = false ? false : false;


</script>

<!-- Ad Serving Headers Only serve ads to Anonymous Users -->





  </head><body>


<!-- Begin navbar -->
<div id="navbar" class="navbar navbar-default navbar-fixed-top" role="navigation">

  <div class="container">

    <div class="navbar-header">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type='button' class='navbar-toggle' data-toggle="collapse" data-target=".navbar-ex1-collapse">
        <span class="icon-bar" aria-label="navbar toggle" class="visuallyhidden">toggle navbar</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div>
        
          <a class="brand-logo" style='background: transparent url("../_static/img/logo_small.png") no-repeat 0px 0px;'>&nbsp;<span aria-label="logo" class="visuallyhidden">Runestone Logo</span> </a>
        
        <a class="navbar-brand" href="../index.html" aria-label="index-page">
          
          cisc187-reader
        </a>
      </div>
    </div>



    <div class="navbar-collapse collapse navbar-ex1-collapse">
      <ul class="nav navbar-nav navbar-right" >

        <li class="divider-vertical"></li>


        <!-- social media dropdown -->
        <!-- end social media dropdown -->

        <li class="divider-vertical"></li>

        <!-- search dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-search" style='opacity:0.9;'><span aria-label="Search" class="visuallyhidden">Search</span></i>
          </a>
          <ul class='dropdown-menu'>
            
                <li><a href='../index.html' aria-label="index-page">Table of Contents</a></li>
            
            <li><a href='../genindex.html'>Book Index</a></li>
            <li class="divider"></li>
            <li style="width: 240px;">
              <form class="navbar-search" style="margin:10px;" action="../search.html" method="get">
                <div class="input-group">
                  <input type="text" class="form-control" name="q" placeholder="Search this book" />
                  <span class="input-group-btn">
                    <button class="btn btn-primary" style="margin:0;" type="submit">
                      <i class="glyphicon glyphicon-search"></i>
                    </button>
                  </span>
                </div><!-- /input-group -->
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
            </li>
          </ul>
        </li>
        <!-- end search dropdown -->

        <li class="divider-vertical"></li>

        
        <li class="divider-vertical"></li>
        <!-- <li id="scratch_ac_link"><a href="javascript:ACFactory.toggleScratchActivecode()">Scratch ActiveCode</a></li> -->

        <!-- <li class="dropdown">             -->
          <li id="scratch_ac_link" class="dropdown"><a href="javascript:ACFactory.toggleScratchActivecode()">
              <i class="glyphicon glyphicon-pencil" style="opacity:0.9;"><span aria-label="Scratch Activecode" class="visuallyhidden">Scratch Activecode</span></i></a></li>
        <!-- </li> -->

        <li class="divider-vertical"></li>

        
      </ul>

      <ul class="nav navbar-nav">
        <li class="divider-vertical"></li>
        
          
          <li class="divider-vertical"></li>
        
        <!-- 
          
  <li id="relations-prev" title="Previous Chapter - <span class="section-number">8.4. </span>Inheritance" data-toggle="tooltip">
    <a href="inheritance.html" >
      <i class='glyphicon glyphicon-backward' style='opacity:0.9;'></i>
    </a>
  </li>
  
  <li id="relations-next" title='Next Chapter - <span class="section-number">8.6. </span>Design patterns' data-toggle="tooltip" >              
    <a href="patterns.html" >
        <i class='glyphicon glyphicon-forward' style='opacity:0.9;'></i>
    </a>
  </li>
  <li class="divider-vertical"></li>

<script type="text/javascript">
  opts = {'placement':'bottom',
          'selector': '',
          'delay': { show: 100, hide: 50}
         };

  $('#relations-prev').tooltip(opts);
  $('#relations-next').tooltip(opts);
</script>
        -->
        
          <li></li>
        
      </ul>

      </div> <!-- navbar -->







    </div> <!-- container -->
  </div>
</div>


<div class="container" id="continue-reading"></div>

<div class="container" id="main-content" role="main">
  
  <div class="section" id="abstract-base-classes">
<span id="index-0"></span><h1><span class="section-number">8.5. </span>Abstract base classes<a class="headerlink" href="#abstract-base-classes" title="Permalink to this headline">¶</a></h1>
<p>Often the functions declared in a base class cannot be defined
in the base class, but instead can only be implemented in the derived
classes.
Consider the shape example from the section <a class="reference internal" href="inheritance.html"><span class="doc">Inheritance</span></a>.
How might we add <code class="docutils literal notranslate"><span class="pre">draw</span></code> and <code class="docutils literal notranslate"><span class="pre">erase</span></code> functions?</p>
<div class="graphviz"><img src="../_images/graphviz-af3a6f6696038cd0a8484ca532be70c7c613ea6f.png" alt="Shape inheritance" class="graphviz" /></div>
<p>There is no situation where drawing a ‘generic shape’ makes sense.
A shape might define general behaviors like <code class="docutils literal notranslate"><span class="pre">draw()</span></code>,
but there is no all-purpose draw function.
The shape class <em>can’t</em> know the implementation ahead of time.
There is a way to code this in C++: by creating an
<a class="reference internal" href="../glossary.html#term-abstract-base-class"><span class="xref std std-term">abstract base class</span></a>.
In C++, an abstract class is any class with at least
one unimplemented function:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">enum</span> <span class="n">Color</span> <span class="p">{</span><span class="n">RED</span><span class="p">,</span> <span class="n">ORANGE</span><span class="p">,</span> <span class="n">YELLOW</span><span class="p">,</span> <span class="n">GREEN</span><span class="p">,</span> <span class="n">BLUE</span><span class="p">,</span> <span class="n">INDIGO</span><span class="p">,</span> <span class="n">VIOLET</span><span class="p">};</span>

<span class="k">class</span> <span class="nc">shape</span> <span class="p">{</span>
    <span class="n">Color</span> <span class="n">color_</span> <span class="o">=</span> <span class="n">Color</span><span class="o">::</span><span class="n">BLUE</span><span class="p">;</span>
  <span class="k">public</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">shape</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
    <span class="kt">void</span>   <span class="nf">color</span> <span class="p">(</span><span class="n">Color</span> <span class="n">new_color</span><span class="p">)</span> <span class="p">{</span> <span class="n">color_</span> <span class="o">=</span> <span class="n">new_color</span><span class="p">;</span> <span class="p">}</span>
    <span class="n">Color</span>  <span class="nf">color</span> <span class="p">()</span>  <span class="k">const</span>         <span class="p">{</span> <span class="k">return</span> <span class="n">color_</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">virtual</span> <span class="kt">void</span>   <span class="nf">move</span><span class="p">();</span>      <span class="c1">// implemented in shape.cpp</span>
    <span class="k">virtual</span> <span class="kt">void</span>   <span class="nf">draw</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span>   <span class="nf">erase</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The functions <code class="docutils literal notranslate"><span class="pre">draw</span></code> and <code class="docutils literal notranslate"><span class="pre">erase</span></code> are marked <a class="reference external" href="http://en.cppreference.com/mwiki/index.php?search=virtual">virtual</a>.
Note the <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">0;</span></code> at the end of the declaration.
Referred to as the <em>pure specifier</em>,
this marks these functions as <em>pure virtual</em>.
It is the presence of at least 1 pure virtual function that
make a class <em>abstract</em>.
In this case, a <code class="docutils literal notranslate"><span class="pre">shape</span></code> does not know how to draw itself.
Code that can only properly be implemented in the class that
properly ‘owns’ the behavior (<code class="docutils literal notranslate"><span class="pre">draw</span></code> and <code class="docutils literal notranslate"><span class="pre">erase</span></code>)
should be implemented in the <em>derived</em> classes.</p>
<p>Because a class the defines a pure virtual function cannot implement it,
that means any class containing a pure virtual function can never be
instantiated.
Given the shape class defined here, this code:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">shape</span> <span class="n">s</span><span class="p">;</span>
</pre></div>
</div>
<p>will not compile.</p>
<p>A class containing at least one pure virtual function can <strong>only</strong>
be used as a base class.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">circle</span><span class="o">:</span> <span class="k">public</span> <span class="n">shape</span> <span class="p">{</span>
   <span class="kt">double</span> <span class="n">radius</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span>   <span class="n">draw</span><span class="p">()</span>  <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
    <span class="kt">void</span>   <span class="nf">erase</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">rectangle</span><span class="o">:</span> <span class="k">public</span> <span class="n">shape</span> <span class="p">{</span>
   <span class="kt">double</span> <span class="n">ht</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
   <span class="kt">double</span> <span class="n">wd</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span>   <span class="n">draw</span><span class="p">()</span>  <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
    <span class="kt">void</span>   <span class="nf">erase</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>There is no requirement that pure virtual functions be implemented
in the first derived class that inherits from a base.
A derived class <em>could</em> implement it,
but can itself remain abstract.
A non-abstract derived class can make itself abstract
by declaring a new pure virtual function,
or by declaring an existing virtual function as pure virtual.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">Base</span> <span class="p">{</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">f</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// pure virtual</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nl">X</span> <span class="p">:</span> <span class="n">Base</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="n">f</span><span class="p">()</span> <span class="k">override</span> <span class="p">{}</span> <span class="c1">// non-pure virtual</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">g</span><span class="p">();</span>     <span class="c1">// non-pure virtual</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nl">Y</span> <span class="p">:</span> <span class="n">X</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="n">g</span><span class="p">()</span> <span class="k">override</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// pure virtual overrider</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nl">Z</span> <span class="p">:</span> <span class="n">Y</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="n">g</span><span class="p">()</span> <span class="k">override</span> <span class="p">{};</span> <span class="c1">// non-pure virtual</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Base</span> <span class="n">b</span><span class="p">;</span>      <span class="c1">// Error: abstract class</span>
    <span class="n">X</span> <span class="n">x</span><span class="p">;</span>         <span class="c1">// OK</span>

    <span class="n">Base</span><span class="o">&amp;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span> <span class="c1">// OK to reference abstract base</span>
    <span class="n">b</span><span class="p">.</span><span class="n">f</span><span class="p">();</span>       <span class="c1">// virtual dispatch to X::f()</span>
    <span class="n">Y</span> <span class="n">y</span><span class="p">;</span>         <span class="c1">// Error: abstract class (final overrider of g() is pure)</span>
    <span class="n">Z</span> <span class="n">z</span><span class="p">;</span>         <span class="c1">// OK: final overrider of g() is non-pure</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="interfaces">
<h2><span class="section-number">8.5.1. </span>Interfaces<a class="headerlink" href="#interfaces" title="Permalink to this headline">¶</a></h2>
<p>When an abstract base class declares no member variables and
declares <strong>only</strong> pure virtual functions,
then the class is referred to as an <em>interface</em>.
Technically, <em>every</em> class with at least 1 member function defines
an interface, however, some languages give interface classes special treatment,
so the term has fallen into use in C++ also.</p>
<p>We can rewrite the abstract class <code class="docutils literal notranslate"><span class="pre">shape</span></code> and convert it
to behave like an interface:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">shape</span> <span class="p">{</span>
  <span class="k">public</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">shape</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span>   <span class="nf">move</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>      <span class="c1">// implemented in shape.cpp</span>
    <span class="k">virtual</span> <span class="kt">void</span>   <span class="nf">draw</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span>   <span class="nf">erase</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Notice we still have a default implementation for move,
even though we declared it to be pure virtual.</p>
<p>Some experts (for example Herb Sutter in his article <em>Virtuality</em>,
advocate it as a best practice to always define virtual methods private,
unless there is a good reason to make them protected.
Virtual methods, in their view, should never be public,
because they define the class interface,
which must remain consistent in all derived classes.
Protected and private virtuals define the class customizable behavior,
and there is no need to make them public.
A public virtual method would define both interface and a customization point,
a duality that could reflect weak design.</p>
<p>The primary problem with this type of public interface is that it doesn’t
hold up well to changing requirements.
If <code class="docutils literal notranslate"><span class="pre">draw</span></code> or <code class="docutils literal notranslate"><span class="pre">erase</span></code> need to return values,
or if we need to add more pure virtual functions,
every derived class is affected.</p>
<p>We can protect ourselves from future changes using the <em>Template Method</em>
design pattern.
The Template Method defines the steps of an algorithm and allows
derived classes to provide implementations for one or more steps:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">hot_drink</span> <span class="p">{</span>
   <span class="k">public</span><span class="o">:</span>
     <span class="o">~</span><span class="n">hot_drink</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
     <span class="kt">void</span> <span class="nf">prepare</span><span class="p">();</span>       <span class="c1">// the template method</span>

   <span class="k">private</span><span class="o">:</span>
     <span class="c1">// ALL implementation steps are private</span>
     <span class="k">virtual</span> <span class="kt">void</span> <span class="n">brew</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">add_extras</span><span class="p">();</span>

     <span class="c1">// non-virtual mandatory parts of the recipe</span>
     <span class="kt">void</span> <span class="nf">heat</span><span class="p">();</span>
     <span class="kt">void</span> <span class="nf">pour</span><span class="p">();</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">hot_drink</span><span class="o">::</span><span class="n">prepare</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">heat</span><span class="p">();</span>
  <span class="n">brew</span><span class="p">();</span>        <span class="c1">// call to the derived class</span>
  <span class="n">pour</span><span class="p">();</span>
  <span class="n">add_extras</span><span class="p">();</span>  <span class="c1">// optionally call derived class</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">hot_drink</span><span class="o">::</span><span class="n">add_extras</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// this default implementation could just be a stub</span>
  <span class="c1">// it can optionally be customized by a derived class</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We now have a generic framework for making all kinds of drinks,
assuming they follow this basic recipe: coffee, tea, etc.</p>
<p>It may be surprising that private virtuals can be overridden,
let alone are valid.
You have likely been taught that private members in a base class
are not accessible in classes derived from it, which is correct.
However this inaccessibility <strong>by</strong> the derived class
does not have anything to do with the virtual call mechanism,
which is <strong>to</strong> the derived class.</p>
<p>What good is a method that the derived class can’t call?
Even though the derived class can’t call it in the base class,
the base class can call it — down to the appropriate derived class.
And that’s what the Template Method pattern is all about.</p>
<p>In our coffee shop, we want to write the base class once,
but still want the flexibility to think of new drink recipes today.
The base class code we wrote a year ago will call
the private virtual methods in its recipe.
This might result in the base class calling code that did not exist
when the base class was originally written.</p>
<p>Once our base class is done, we can implement derived classes:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">coffee</span> <span class="o">:</span> <span class="k">public</span> <span class="n">hot_drink</span> <span class="p">{</span>
   <span class="k">public</span><span class="o">:</span>
     <span class="o">~</span><span class="n">coffee</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
   <span class="k">private</span><span class="o">:</span>
     <span class="k">virtual</span> <span class="kt">void</span> <span class="n">brew</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">add_extras</span><span class="p">();</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">coffee</span><span class="o">::</span><span class="n">brew</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// drip water through grinds</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">coffee</span><span class="o">::</span><span class="n">add_extras</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// add milk and sugar</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">tea</span> <span class="o">:</span> <span class="k">public</span> <span class="n">hot_drink</span> <span class="p">{</span>
   <span class="k">public</span><span class="o">:</span>
     <span class="o">~</span><span class="n">tea</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
   <span class="k">private</span><span class="o">:</span>
     <span class="k">virtual</span> <span class="kt">void</span> <span class="n">brew</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">add_extras</span><span class="p">();</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">tea</span><span class="o">::</span><span class="n">brew</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// steep tea in water</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">tea</span><span class="o">::</span><span class="n">add_extras</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// add lemon</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And use it:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">coffee</span> <span class="n">c</span><span class="p">;</span>
  <span class="n">c</span><span class="p">.</span><span class="n">prepare</span><span class="p">();</span>

  <span class="n">tea</span> <span class="n">t</span><span class="p">;</span>
  <span class="n">t</span><span class="p">.</span><span class="n">prepare</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="the-final-specifier">
<h2><span class="section-number">8.5.2. </span>The final specifier<a class="headerlink" href="#the-final-specifier" title="Permalink to this headline">¶</a></h2>
<p>Added in C++11,
this keyword specifies that a virtual function cannot be overridden
in a derived class or that a class cannot be inherited from.</p>
<p>When used in a virtual function declaration or definition,
<a class="reference external" href="http://en.cppreference.com/mwiki/index.php?search=final">final</a> ensures that the function is virtual and specifies
that it may not be overridden by derived classes.
Attempting to override a final function is a compile error.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">Base</span>
<span class="p">{</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">foo</span><span class="p">();</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nl">A</span> <span class="p">:</span> <span class="n">Base</span>
<span class="p">{</span>
    <span class="kt">void</span> <span class="n">foo</span><span class="p">()</span> <span class="k">final</span><span class="p">;</span> <span class="c1">// A::foo is overridden and it is the final override</span>
    <span class="kt">void</span> <span class="nf">bar</span><span class="p">()</span> <span class="k">final</span><span class="p">;</span> <span class="c1">// Error: non-virtual function cannot be overridden or be final</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">B</span> <span class="k">final</span> <span class="o">:</span> <span class="n">A</span> <span class="c1">// struct B is final</span>
<span class="p">{</span>
    <span class="kt">void</span> <span class="n">foo</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span> <span class="c1">// Error: foo cannot be overridden as it&#39;s final in A</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nl">C</span> <span class="p">:</span> <span class="n">B</span> <span class="c1">// Error: B is final</span>
<span class="p">{</span>
<span class="p">};</span>
</pre></div>
</div>
<hr class="docutils" />
<div class="admonition-more-to-explore admonition">
<p class="admonition-title">More to Explore</p>
<ul class="simple">
<li><p>From cppreference.com:
- <a class="reference external" href="https://en.cppreference.com/w/cpp/language/virtual">virtual function specifier</a>
- <a class="reference external" href="https://en.cppreference.com/w/cpp/language/abstract_class">Abstract classes</a>
- <a class="reference external" href="https://en.cppreference.com/w/cpp/language/final">final specifier</a></p></li>
<li><p><a class="reference external" href="http://www.gotw.ca/publications/mill18.htm">Virtuality</a> by Herb Sutter</p></li>
</ul>
</div>
</div>
</div>


  <div id=scprogresscontainer>
    You have attempted <span id=scprogresstotal></span> of <span id=scprogressposs></span> activities on this page <div id="subchapterprogress"></div>
  </div>
  
      
<ul>
  <li id="relations-prev" style="opacity:0.4" onmouseover="mouseOverPrev()" onmouseout="mouseOutPrev()"class="navLink" title='Previous Section - 8.4. Inheritance' data-toggle="tooltip">
    <a href="inheritance.html" aria-label="8.4. Inheritance">
        <div style="background-color: white; border-style:solid; border-color:lightgrey; border-width:2px; width:100px; height:50px">
            <i class='prevNav glyphicon glyphicon-chevron-left'  style="top:50%; transform:translateY(-50%)translateX(-50%); left: 50%; color:black;"></i>
        </div>
    </a>
  </li>
</ul>

  
<ul>
  <li id="relations-next" style="opacity:0.4" onmouseover="mouseOverNext()" onmouseout="mouseOutNext()" class="navLink" title='Next Section - 8.6. Design patterns' data-toggle="tooltip" >
    <a href="patterns.html" aria-label="8.6. Design patterns">
      <div style="background-color: white; border-style:solid; border-color:lightgrey; border-width:2px; width:100px; height:50px">
          <i id="relationsNextIcon" class='nextNav glyphicon glyphicon-chevron-right' style="top:50%; transform:translateY(-50%)translateX(-50%); left: 50%; color:black; "></i>
      </div>
    </a>
  </li>
</ul>

<script type="text/javascript">

  $('#relations-prev').tooltip({'placement':'right', 'selector': '', 'delay': { show: 100, hide: 50}});
  $('#relations-next').tooltip({'placement':'left', 'selector': '', 'delay': { show: 100, hide: 50}});

</script>

<script>
	function mouseOverPrev() {
		document.getElementById("relations-prev").style.opacity=1;
	}

	function mouseOutPrev() {
		document.getElementById("relations-prev").style.opacity=0.4;
	}
	function mouseOverNext() {
		document.getElementById("relations-next").style.opacity=1;
	}

	function mouseOutNext() {
		document.getElementById("relations-next").style.opacity=0.4;
	}
</script>
  
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      
      | <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017-2020 Dave Parillo.
      Created using <a href="http://runestoneinteractive.org/">Runestone</a> 5.0.8.
    </p>
  </div>
</footer>




<script> getSwitch(); </script>


  </body>
</html>