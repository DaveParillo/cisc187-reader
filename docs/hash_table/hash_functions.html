<!-- ****************************************
     |docname| - main template for this theme
     **************************************** -->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>15.2. Hash functions &#8212; CISC 187 Course Reader Overview</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/matrixeq.css?v=58BC228F" />
    <link rel="stylesheet" type="text/css" href="../_static/CodeChat.css" />
    <link rel="stylesheet" type="text/css" href="../_static/webgldemo.css?v=B36B48D" />
    <link rel="stylesheet" type="text/css" href="../_static/webglinteractive.css?v=910DF1E1" />
    <link rel="stylesheet" type="text/css" href="../_static/accessibility.css?v=50109A2C" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/637.0fa6cababf056764.css?v=F9484CEF" />
    <link rel="stylesheet" type="text/css" href="../_static/runestone.3eb60bc006ae9a54.css?v=3A5A250C" />



    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/matrixeq.js?v=D64CFA5A"></script>
    <script src="../_static/animationbase.js?v=A043C3A7"></script>
    <script src="../_static/html4css1.css?v=4533ACD3"></script>
    <script src="../_static/webglinteractive.js?v=2B768384"></script>
    <script src="../_static/FileSaver.min.js?v=8408C997"></script>
    <script src="../_static/runtime.66b619f51b746382.bundle.js?v=C3F69EE5"></script>
    <script src="../_static/637.d54be67956c5c660.bundle.js?v=915B1670"></script>
    <script src="../_static/runestone.ecc6dff5cad8b815.bundle.js?v=AE959292"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://media.ethicalads.io/media/client/ethicalads.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="15.3. Resolving collisions" href="hash_table_collisions.html" />
    <link rel="prev" title="15.1. Hashing concepts" href="hash_table.html" />


<link rel="shortcut icon" href="/cisc187-reader/static/favicon.ico" type="image/ico" />



<link rel="canonical" href="https://{{canonical_host}}{{new_server_prefix}}/books/published/{{base_course}}/{{pagepath}}" />


<script>
  eBookConfig = {};
  
    eBookConfig.useRunestoneServices = false;
    eBookConfig.host = 'https://daveparillo.github.io/cisc187-reader/' || 'http://127.0.0.1:8000';
    eBookConfig.app = eBookConfig.host+'/cisc187-reader';
    eBookConfig.course = 'cisc187-reader';
    eBookConfig.basecourse = 'cisc187-reader';
    eBookConfig.isLoggedIn = false;
    eBookConfig.enableCompareMe = eBookConfig.useRunestoneServices;
    eBookConfig.new_server_prefix = '';
  
  eBookConfig.ajaxURL = eBookConfig.app+'/ajax/';
  eBookConfig.logLevel = 0;
  eBookConfig.loginRequired = false;
  eBookConfig.build_info = "unknown";
  eBookConfig.python3 = true;
  eBookConfig.acDefaultLanguage = 'cpp' ? 'cpp' : 'python'
  eBookConfig.runestone_version = '6.6.2';
  eBookConfig.jobehost = 'https://red-voice-1370.fly.dev/http://jobe2.cosc.canterbury.ac.nz';
  eBookConfig.proxyuri_runs = '/jobe/index.php/restapi/runs/';
  eBookConfig.proxyuri_files = '/jobe/index.php/restapi/files/';
  eBookConfig.enable_chatcodes = false ? false : false;
  eBookConfig.enableScratchAC = true;

</script>

<!-- Ad Serving Headers Only serve ads to Anonymous Users -->



  </head><body>


<!-- Begin navbar -->
<div id="navbar" class="navbar navbar-default navbar-fixed-top" role="navigation">

  <div class="container">

    <div class="navbar-header">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type='button' class='navbar-toggle' data-toggle="collapse" data-target=".navbar-ex1-collapse" aria-label="navbar toggle">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div>
        
        
          <div class="brand-logo"><img src="../_static/img/RAIcon.png" alt=""></div>
        
        <a class="navbar-brand" href="../index.html" aria-label="index-page">
          
          cisc187-reader
        </a>
      </div>
    </div>



    <div class="navbar-collapse collapse navbar-ex1-collapse">
      <ul class="nav navbar-nav navbar-right" >

        <li class="divider-vertical"></li>

        <!-- social media dropdown -->
        <!-- end social media dropdown -->

        <li class="divider-vertical"></li>
        <!-- search dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-search" style='opacity:0.9;'><span class="visuallyhidden" aria-label="Search">Search</span></i>
          </a>
          <ul class='dropdown-menu'>
            
                <li><a href='../index.html' aria-label="index-page">Table of Contents</a></li>
            
            <li><a href='../genindex.html'>Book Index</a></li>
            <li class="divider"></li>
            <li style="width: 240px;">
              <form class="navbar-search" style="margin:10px;" action="../search.html" method="get">
                <div class="input-group">
                  <input type="text" class="form-control" name="q" placeholder="Search this book" />
                  <span class="input-group-btn">
                    <button class="btn btn-primary" style="margin:0;" type="submit">
                      <i class="glyphicon glyphicon-search"></i>
                    </button>
                  </span>
                </div><!-- /input-group -->
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
            </li>
          </ul>
        </li>
        <!-- end search dropdown -->

        <li class="divider-vertical"></li>

        
        <li class="divider-vertical"></li>

        
      </ul>

      <ul class="nav navbar-nav">
        <li class="divider-vertical"></li>
        
          
          <li class="divider-vertical"></li>
        
        <!-- 
          
  <li id="relations-prev" title="Previous Chapter - <span class="section-number">15.1. </span>Hashing concepts" data-toggle="tooltip">
    <a href="hash_table.html" >
      <i class='glyphicon glyphicon-backward' style='opacity:0.9;'></i>
    </a>
  </li>
  
  <li id="relations-next" title='Next Chapter - <span class="section-number">15.3. </span>Resolving collisions' data-toggle="tooltip" >              
    <a href="hash_table_collisions.html" >
        <i class='glyphicon glyphicon-forward' style='opacity:0.9;'></i>
    </a>
  </li>
  <li class="divider-vertical"></li>

<script>
  opts = {'placement':'bottom',
          'selector': '',
          'delay': { show: 100, hide: 50}
         };

  window.addEventListener('load', (event) => {
    $('#relations-prev').tooltip(opts);
    $('#relations-next').tooltip(opts);
  });
</script>
        -->
        
          <li></li>
        
      </ul>
      </div> <!-- navbar-collapse -->
    </div> <!-- navbar -->
  </div> <!-- container -->


<div class="container" id="continue-reading"></div>

<div class="container" id="main-content" role="main">

	<div class="admonition note">
		<p class="admonition-title">
		Compiling in this book is temporarily broken.
		</p>
		<p>
		Until I have a chance to fix it, you can copy and paste code from the text area into an online compiler such as
		<a href="https://coliru.stacked-crooked.com/">Coliru</a>,
		<a href="https://www.onlinegdb.com/online_c++_compiler">Online GDB</a>, 
		<a href="https://godbolt.org/">GodBolt</a>, or
		<a href="https://replit.com/">Replit</a>. 
		Thank you for your patience.</p>
	</div>
	<!-- Ad Serving for Runestone Campaign -->
	

	
  <section id="hash-functions">
<span id="index-0"></span><h1><span class="section-number">15.2. </span>Hash functions<a class="headerlink" href="#hash-functions" title="Permalink to this heading">¶</a></h1>
<p>Unless we have special knowledge about the keys,
the best we can say about “minimizing the number of collisions”
is that we hope that our hashing function will distribute the keys uniformly,
that is, if keys are selected at random, then the probability of the next
key going into any particular position in the hash table should be
the same as for any other position.</p>
<p>This is sometimes harder to achieve in practice than we might expect.</p>
<p>So to recap: a good hash function:</p>
<ul class="simple">
<li><p>Is fast and easy to compute</p></li>
<li><p>Distributes keys uniformly across the table.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Don’t get hung up on trying to find hash functions that “mean something”.
Most hash functions don’t compute anything useful or “natural”.
They are simply functions chosen to satisfy our requirements
(fast and uniform over the range <span class="math notranslate nohighlight">\(0 \to (table\_size-1)\)</span>.</p>
</div>
<section id="integer-hashes">
<h2><span class="section-number">15.2.1. </span>Integer hashes<a class="headerlink" href="#integer-hashes" title="Permalink to this heading">¶</a></h2>
<p>If your integers are already in the range <span class="math notranslate nohighlight">\(0 \to (table\_size-1)\)</span>
then there is nothing to do:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">hash</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;}</span>
</pre></div>
</div>
<p>So integer keys are easy, but you can’t always take them for granted.
A company once assigned an integer ID number to every employee.
When the computerized system for the company payroll was created,
the way the IDs were assigned when like this:</p>
<ul class="simple">
<li><p>Start with a list of all current employees, in alphabetical order by name.</p></li>
<li><p>Assign the first person in the list the ID <code class="docutils literal notranslate"><span class="pre">00005</span></code>,
the next person <code class="docutils literal notranslate"><span class="pre">00010</span></code>, then <code class="docutils literal notranslate"><span class="pre">00015</span></code>, and so on.</p></li>
</ul>
<p>This left “gaps” in the ID number sequence that could be used later for new employees.</p>
<p>When a new person was hired,
someone would compare the new person’s name to the alphabetical list of
employee names and would assign the new person a number lying somewhere
in the gap between the people already in the list.</p>
<p>Because of this scheme,
more than 3/4 of the ID numbers in the company were evenly divisible by 5.</p>
<p>Let’s suppose some hash table with <code class="docutils literal notranslate"><span class="pre">size</span> <span class="pre">==</span> <span class="pre">100</span></code> simply use the hash
function described previously and use <code class="docutils literal notranslate"><span class="pre">%</span></code> to constrain them to the table:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">hash</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="p">;}</span>
</pre></div>
</div>
<p>There are 20 numbers divisible by 5 in the range from 0 to 99.
So 3/4 of the ID numbers would hash into only 1/5 of the table positions.
These numbers are not being distributed uniformly.</p>
<p>There is an easy fix:
change the hash table size to <code class="docutils literal notranslate"><span class="pre">101</span></code>.
Making the table just 1 element larger improves the distribution considerably:</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>keys</p></td>
<td><p>hash to</p></td>
</tr>
<tr class="row-even"><td><p>00005, 00010, …, 00100</p></td>
<td><p>5, 10, …, 100</p></td>
</tr>
<tr class="row-odd"><td><p>00105, 00110, …, 00200</p></td>
<td><p>4, 9, …, 99</p></td>
</tr>
<tr class="row-even"><td><p>00205, 00210, …, 00300</p></td>
<td><p>3, 8, …, 98</p></td>
</tr>
<tr class="row-odd"><td><p>00305, 00310, …, 00400</p></td>
<td><p>2, 7, …, 97</p></td>
</tr>
</tbody>
</table>
<p>The lesson here: the distribution of the original key values is important.</p>
<p>The difference between using 100 vs using 101 is no accident.
Choosing prime numbers for hash table sizes tends to
increase the uniformity of key distributions.</p>
</section>
<section id="string-hashes">
<h2><span class="section-number">15.2.2. </span>String hashes<a class="headerlink" href="#string-hashes" title="Permalink to this heading">¶</a></h2>
<p>Hash functions for strings generally work by adding up some expression applied
to each character in the string
(remember that a char is just another integer type in C++).</p>
<p>We need to be a little careful to get an appropriate distribution.
Although a char could be any of 255 different values,
most strings actually contain only the 96 “printable” characters starting at
ASCII value 32 (blank).</p>
<p>Also we often want to make sure that similar strings,
likely to occur together, don’t hash to the same location.
So a simple hash function like this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">unsigned</span><span class="w"> </span><span class="nf">hash</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">words</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c</span><span class="o">:</span><span class="w"> </span><span class="n">words</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="n">h</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">h</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>doesn’t work very well.
Words that differ only by transposition of characters have the same value.</p>
<p>An improved approach is to account for the position of each character
in the string.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">unsigned</span><span class="w"> </span><span class="nf">hash</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">words</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">   </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">17</span><span class="p">;</span><span class="w">  </span><span class="c1">// or any suitable prime</span>
<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c</span><span class="o">:</span><span class="w"> </span><span class="n">words</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="o">*</span><span class="n">factor</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">h</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">h</span></code> becomes large, eventually this expression may overflow,
but for unsigned types this is not a problem.
Again, we are looking for a uniform distribution of values we can
generate for our hash table.</p>
<p>Manually writing our own hash functions for builtin
standard library types is not needed.
The STL provides the template <a class="reference external" href="https://en.cppreference.com/w/cpp/utility/hash">std::hash</a>
and a set of standard overrides for types in the standard library.</p>
</section>
<section id="hashing-user-defined-types">
<h2><span class="section-number">15.2.3. </span>Hashing user defined types<a class="headerlink" href="#hashing-user-defined-types" title="Permalink to this heading">¶</a></h2>
<p>If you define your own <code class="docutils literal notranslate"><span class="pre">struct</span></code> or <code class="docutils literal notranslate"><span class="pre">class</span></code>, you need to write your own
hash function.
Normally this will be a <code class="docutils literal notranslate"><span class="pre">std::hash&lt;&gt;</span></code> override.
Consider a <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">point</span></code> and a sample hash function:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">point</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;&gt;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">hash</span><span class="o">&lt;</span><span class="n">point</span><span class="o">&gt;</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="nf">operator</span><span class="p">()(</span><span class="k">const</span><span class="w"> </span><span class="n">point</span><span class="o">&amp;</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">hash</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">()(</span><span class="mi">7919</span><span class="p">)</span><span class="w"> </span><span class="c1">// or any suitable prime</span>
<span class="w">             </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">hash</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">()(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">73</span>
<span class="w">             </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">hash</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">()(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">557</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">std::hash</span></code> override must be a function template,
although in this case, no template parameter is needed.
The template declaration <code class="docutils literal notranslate"><span class="pre">template</span> <span class="pre">&lt;&gt;</span></code> is perfectly valid.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notice a recurring theme: prime numbers as multipliers.
Prime numbers as multipliers help minimize collisions when the hash values
of different parts of an object have the same value
or are simple multiples of one another.</p>
</div>
<hr class="docutils" />
<div class="admonition-more-to-explore admonition">
<p class="admonition-title">More to Explore</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.partow.net/programming/hashfunctions/">General purpose hash function algorithms</a></p></li>
</ul>
</div>
</section>
</section>


	

	<div id="scprogresscontainer">
		You have attempted <span id="scprogresstotal"></span> of <span id="scprogressposs"></span> activities on this page <div id="subchapterprogress" aria-label="Page progress"></div>
	</div>

	<ul role="navigation" class="nextprev-list nextprev-list" aria-label="Change page">
<li id="relations-prev" class="navLink" title='Previous Section - 15.1. Hashing concepts' data-toggle="tooltip">
  <a href="hash_table.html" aria-label="Previous - 15.1. Hashing concepts">
    <i class='prevNav glyphicon glyphicon-chevron-left'  style="top:50%; transform:translateY(-50%)translateX(-50%); left: 50%; color:black;"></i>
  </a>
</li>

  <li id="relations-next" class="navLink" title='Next Section - 15.3. Resolving collisions' data-toggle="tooltip" >
    <a href="hash_table_collisions.html" aria-label="Next - 15.3. Resolving collisions">
      <i id="relationsNextIcon" class='nextNav glyphicon glyphicon-chevron-right' style="top:50%; transform:translateY(-50%)translateX(-50%); left: 50%; color:black; "></i>
    </a>
  </li>
</ul>

<script>
window.addEventListener('load', (event) => {
  $('#relations-prev').tooltip({'placement': 'right', 'delay': { show: 100, hide: 50}});
  $('#relations-next').tooltip({'placement': 'left', 'delay': { show: 100, hide: 50}});
});
</script>

</div>
<footer class="footer">
	<div class="container">
		<p class="pull-right">
		
		| <a href="#">Back to top</a>
		
		</p>
		<p>
		&copy; Copyright 2017-2023 Dave Parillo.
		Created using <a href="http://runestoneinteractive.org/">Runestone</a> 6.6.2.
		</p>
	</div>
</footer>




<script>
	window.addEventListener('load', (event) => {
		runestoneComponents.getSwitch();
	});
</script>


  </body>
</html>