<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5.2. Free store pointers &#8212; CISC 187 Course Reader Overview</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/matrixeq.css?v=58BC228F" />
    <link rel="stylesheet" type="text/css" href="../_static/CodeChat.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/handsontable@7.2.2/dist/handsontable.full.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/webgldemo.css?v=B36B48D" />
    <link rel="stylesheet" type="text/css" href="../_static/webglinteractive.css?v=910DF1E1" />
    <link rel="stylesheet" type="text/css" href="../_static/accessibility.css?v=50109A2C" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-3.4.1/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/presenter_mode.css?v=9FF1320F" />
    <link rel="stylesheet" type="text/css" href="../_static/jquery-ui-1.10.3.custom.min.css?v=97E0178A" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/user-highlights.css?v=A2326E52" />
    <link rel="stylesheet" type="text/css" href="../_static/runestone-custom-sphinx-bootstrap.css?v=5.5.5" />
    <link rel="stylesheet" type="text/css" href="../_static/theme-overrides.css?v=2DAFE138" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/pytutor-embed.bundle.js?v=268B5C04"></script>
    <script src="../_static/matrixeq.js?v=D64CFA5A"></script>
    <script src="../_static/animationbase.js?v=A043C3A7"></script>
    <script src="../_static/html4css1.css?v=4533ACD3"></script>
    <script src="../_static/jquery.highlight.js?v=F1C496C8"></script>
    <script src="../_static/sql-wasm.js?v=D71B5933"></script>
    <script src="https://cdn.jsdelivr.net/npm/handsontable@7.2.2/dist/handsontable.full.js"></script>
    <script src="../_static/webglinteractive.js?v=2B768384"></script>
    <script src="../_static/FileSaver.min.js?v=8408C997"></script>
    <script src="../_static/Blob.js?v=AEC2447"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.5/jquery.i18n.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.5/jquery.i18n.emitter.bidi.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.5/jquery.i18n.emitter.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.5/jquery.i18n.fallbacks.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.5/jquery.i18n.messagestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.5/jquery.i18n.parser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.5/jquery.i18n.language.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega@4.0.0-rc.2/build/vega.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@2.5.0/build/vega-lite.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@3.14.0/build/vega-embed.js"></script>
    <script src="../_static/runestone.js?v=92D8BBF0"></script>
    <script src="../_static/jquery-ui-1.10.3.custom.min.js?v=2B07FE4F"></script>
    <script src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
    <script src="../_static/jquery-fix.js?v=1226591B"></script>
    <script src="../_static/bootstrap-sphinx.js"></script>
    <script src="../_static/jquery.idle-timer.js?v=E942DAF1"></script>
    <script src="../_static/presenter_mode.js?v=2DF16FB4"></script>
    <script src="../_static/theme.js?v=D899FB97"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5.3. Pointer debugging" href="valgrind.html" />
    <link rel="prev" title="5.1. Pointers" href="pointers.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
<link rel="shortcut icon" href="/cisc187-reader/static/favicon.ico" type="image/ico" />

<script type="text/javascript">
  eBookConfig = {};
  
    eBookConfig.useRunestoneServices = false;
    eBookConfig.host = 'https://daveparillo.github.io/cisc187-reader/' || 'http://127.0.0.1:8000';
    eBookConfig.app = eBookConfig.host+'/cisc187-reader';
    eBookConfig.course = 'cisc187-reader';
    eBookConfig.basecourse = 'cisc187-reader';
    eBookConfig.isLoggedIn = false;
  
  eBookConfig.ajaxURL = eBookConfig.app+'/ajax/';
  eBookConfig.logLevel = 0;
  eBookConfig.loginRequired = false;
  eBookConfig.build_info = "unknown";
  eBookConfig.python3 = true;
  eBookConfig.acDefaultLanguage = 'cpp' ? 'cpp' : 'python'
  eBookConfig.runestone_version = '5.5.5';
  eBookConfig.jobehost = 'https://fierce-ridge-58946.herokuapp.com/http://jobe2.cosc.canterbury.ac.nz';
  eBookConfig.proxyuri_runs = '/jobe/index.php/restapi/runs/';
  eBookConfig.proxyuri_files = '/jobe/index.php/restapi/files/';
  eBookConfig.enable_chatcodes = false ? false : false;


</script>

<!-- Ad Serving Headers Only serve ads to Anonymous Users -->





  </head><body>


<!-- Begin navbar -->
<div id="navbar" class="navbar navbar-default navbar-fixed-top" role="navigation">

  <div class="container">

    <div class="navbar-header">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type='button' class='navbar-toggle' data-toggle="collapse" data-target=".navbar-ex1-collapse">
        <span class="icon-bar" aria-label="navbar toggle" class="visuallyhidden">toggle navbar</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div>
        
          <a class="brand-logo" style='background: transparent url("../_static/img/logo_small.png") no-repeat 0px 0px;'>&nbsp;<span aria-label="logo" class="visuallyhidden">Runestone Logo</span> </a>
        
        <a class="navbar-brand" href="../index.html" aria-label="index-page">
          
          cisc187-reader
        </a>
      </div>
    </div>



    <div class="navbar-collapse collapse navbar-ex1-collapse">
      <ul class="nav navbar-nav navbar-right" >

        <li class="divider-vertical"></li>


        <!-- social media dropdown -->
        <!-- end social media dropdown -->

        <li class="divider-vertical"></li>

        <!-- search dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-search" style='opacity:0.9;'><span aria-label="Search" class="visuallyhidden">Search</span></i>
          </a>
          <ul class='dropdown-menu'>
            
                <li><a href='../index.html' aria-label="index-page">Table of Contents</a></li>
            
            <li><a href='../genindex.html'>Book Index</a></li>
            <li class="divider"></li>
            <li style="width: 240px;">
              <form class="navbar-search" style="margin:10px;" action="../search.html" method="get">
                <div class="input-group">
                  <input type="text" class="form-control" name="q" placeholder="Search this book" />
                  <span class="input-group-btn">
                    <button class="btn btn-primary" style="margin:0;" type="submit">
                      <i class="glyphicon glyphicon-search"></i>
                    </button>
                  </span>
                </div><!-- /input-group -->
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
            </li>
          </ul>
        </li>
        <!-- end search dropdown -->

        <li class="divider-vertical"></li>

        
        <li class="divider-vertical"></li>
        <!-- <li id="scratch_ac_link"><a href="javascript:ACFactory.toggleScratchActivecode()">Scratch ActiveCode</a></li> -->

        <!-- <li class="dropdown">             -->
          <li id="scratch_ac_link" class="dropdown"><a href="javascript:ACFactory.toggleScratchActivecode()">
              <i class="glyphicon glyphicon-pencil" style="opacity:0.9;"><span aria-label="Scratch Activecode" class="visuallyhidden">Scratch Activecode</span></i></a></li>
        <!-- </li> -->

        <li class="divider-vertical"></li>

        
      </ul>

      <ul class="nav navbar-nav">
        <li class="divider-vertical"></li>
        
          
          <li class="divider-vertical"></li>
        
        <!-- 
          
  <li id="relations-prev" title="Previous Chapter - <span class="section-number">5.1. </span>Pointers" data-toggle="tooltip">
    <a href="pointers.html" >
      <i class='glyphicon glyphicon-backward' style='opacity:0.9;'></i>
    </a>
  </li>
  
  <li id="relations-next" title='Next Chapter - <span class="section-number">5.3. </span>Pointer debugging' data-toggle="tooltip" >              
    <a href="valgrind.html" >
        <i class='glyphicon glyphicon-forward' style='opacity:0.9;'></i>
    </a>
  </li>
  <li class="divider-vertical"></li>

<script type="text/javascript">
  opts = {'placement':'bottom',
          'selector': '',
          'delay': { show: 100, hide: 50}
         };

  $('#relations-prev').tooltip(opts);
  $('#relations-next').tooltip(opts);
</script>
        -->
        
          <li></li>
        
      </ul>

      </div> <!-- navbar -->







    </div> <!-- container -->
  </div>
</div>


<div class="container" id="continue-reading"></div>

<div class="container" id="main-content" role="main">
<!-- Ad Serving for Runestone Campaign -->


  
  <div class="section" id="free-store-pointers">
<span id="index-0"></span><h1><span class="section-number">5.2. </span>Free store pointers<a class="headerlink" href="#free-store-pointers" title="Permalink to this headline">¶</a></h1>
<p>So far, all of our variables have been created on the <a class="reference internal" href="../glossary.html#term-stack"><span class="xref std std-term">stack</span></a>.
Another way to say this is our variables have <em>automatic storage duration</em>.
Variables exist only as long as the scope in which they were created.
Sometimes, we need to create objects with dynamic storage duration,
that is, objects whose lifetime is not limited by the scope in which they were created.</p>
<p>One way to do this is to use the <a class="reference external" href="http://en.cppreference.com/mwiki/index.php?search=operator new">operator new</a> to create objects on the <a class="reference internal" href="../glossary.html#term-free-store"><span class="xref std std-term">free store</span></a>.
The free store is a system-provided memory pool for variables whose lifetime is
directly managed by the programmer.
Compare this to our experiences so far where variables were <em>automatically</em>
managed by the system, not by the programmer.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">new</span></code> operator takes a type and (optionally) a set of initializers for that type as its arguments.
It returns a pointer to an (optionally) initialized object of its type:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nc">Point</span> <span class="p">{</span>
     <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// member values is a C++11 feature</span>
     <span class="kt">double</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">p1</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">;</span>     <span class="c1">// allocate 1 uninitialized int</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">p2</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>  <span class="c1">// allocate 3 uninitialized ints</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">p3</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>  <span class="c1">// allocate 1 int initialized to 5</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">p4</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">{</span><span class="mi">5</span><span class="p">};</span>  <span class="c1">// allocate 1 int initialized to 5, C++11 or later</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">p5</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">();</span>   <span class="c1">// allocate 1 int initialized to 0</span>

  <span class="n">Point</span><span class="o">*</span> <span class="n">pt1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="p">;</span>          <span class="c1">// allocate a default constructed Point</span>
  <span class="n">Point</span><span class="o">*</span> <span class="n">pt2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="p">();</span>        <span class="c1">// allocate a default constructed Point</span>
  <span class="n">Point</span><span class="o">*</span> <span class="n">pt3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>       <span class="c1">// allocate 3 default constructed Points</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Step through <a class="reference external" href="http://pythontutor.com/cpp.html#code=struct%20Point%20%7B%0A%20%20double%20x%20%3D%200%3B%20%20//%20member%20values%20is%20a%20C%2B%2B11%20feature%0A%20%20double%20y%20%3D%200%3B%0A%7D%3B%0A%0Aint%20main%28%29%20%7B%0A%20int*%20p1%20%3D%20new%20int%3B%20%20%20%20%20//%20allocate%201%20uninitialized%20int%0A%20int*%20p2%20%3D%20new%20int%5B3%5D%3B%20%20//%20allocate%203%20uninitialized%20ints%0A%20int*%20p3%20%3D%20new%20int%285%29%3B%20%20//%20allocate%201%20int%20initialized%20to%205%0A%20int*%20p4%20%3D%20new%20int%7B5%7D%3B%20%20//%20allocate%201%20int%20initialized%20to%205,%20C%2B%2B11%20or%20later%0A%20int*%20p5%20%3D%20new%20int%28%29%3B%20%20%20//%20allocate%201%20int%20initialized%20to%200%0A%0A%20Point*%20pt1%20%3D%20new%20Point%3B%20%20%20%20%20%20%20%20%20%20//%20allocate%20a%20default%20constructed%20Point%20%0A%20Point*%20pt2%20%3D%20new%20Point%28%29%3B%20%20%20%20%20%20%20%20//%20allocate%20a%20default%20constructed%20Point%20%0A%20Point*%20pt3%20%3D%20new%20Point%5B3%5D%3B%20%20%20%20%20%20%20//%20allocate%203%20default%20constructed%20Points%0A%7D&amp;mode=display&amp;origin=opt-frontend.js&amp;py=cpp&amp;rawInputLstJSON=%5B%5D">example 1 here</a>.</p>
<p>In all of the above cases,
since the <code class="docutils literal notranslate"><span class="pre">new</span></code> operator returns a pointer to an object of its type,
the initialization could use <code class="docutils literal notranslate"><span class="pre">auto</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">pt1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="p">;</span>
</pre></div>
</div>
<p>The <a class="reference external" href="http://en.cppreference.com/mwiki/index.php?search=operator new">operator new</a> allocates memory.
When finished with the free-store memory,
we return it to the pool of available memory using
the <a class="reference external" href="http://en.cppreference.com/mwiki/index.php?search=operator delete">operator delete</a>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nc">Point</span> <span class="p">{</span>
     <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// member values is a C++11 feature</span>
     <span class="kt">double</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">p1</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">;</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">p2</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>

  <span class="n">Point</span><span class="o">*</span> <span class="n">pt_x</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="p">;</span>
  <span class="n">Point</span><span class="o">*</span> <span class="n">points</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

  <span class="k">delete</span>   <span class="n">p1</span><span class="p">;</span>  <span class="c1">// free memory allocated for a single object</span>
  <span class="k">delete</span><span class="p">[]</span> <span class="n">p2</span><span class="p">;</span>  <span class="c1">// free array memory</span>

  <span class="k">delete</span>   <span class="n">pt_x</span><span class="p">;</span>  <span class="c1">// same syntax is used for user defined types also</span>
  <span class="k">delete</span><span class="p">[]</span> <span class="n">points</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>There should always be exactly 1 <code class="docutils literal notranslate"><span class="pre">delete</span></code> for every pointer returned by <code class="docutils literal notranslate"><span class="pre">new</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are two forms of <code class="docutils literal notranslate"><span class="pre">delete</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">delete</span> <span class="pre">p</span></code> frees the memory for a single object allocated using <code class="docutils literal notranslate"><span class="pre">new</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete[]</span> <span class="pre">p</span></code> frees the memory for an array of objects allocated using <code class="docutils literal notranslate"><span class="pre">new</span></code></p></li>
</ul>
<p>Mistakes over which version of delete to use is a common source of error.</p>
</div>
<p>Other mistakes related to delete include deleting the same pointer twice,
or not deleting the pointer at all.</p>
<p>Deleting the same pointer twice is a problem because it leads to undefined
or unpredictable behavior.
The problem rarely arises in very small or short programs.
However, in larger programs, strange or unpredictable events may happen
long after the statements that perform the double delete are executed.
Programs that free memory twice have created real-world
<a class="reference external" href="http://www.kb.cert.org/vuls/id/650937">security vulnerabilities</a>.</p>
<p>Simply choosing to never delete a pointer on the theory that
“well, at least my program won’t crash” is not a good idea either.
All computers have a finite amount of memory.
Depending on how long your program needs to run,
never returning unused memory back to the memory <em>pool</em> is
referred to as a <a class="reference internal" href="../glossary.html#term-memory-leak"><span class="xref std std-term">memory leak</span></a>.
Also, remember that computers are <em>fast</em>.
Depending on what your program does,
even a short program can run out of memory before accomplishing all of its goals.</p>
<div class="section" id="stl-memory-management">
<span id="index-1"></span><h2><span class="section-number">5.2.1. </span>STL memory management<a class="headerlink" href="#stl-memory-management" title="Permalink to this headline">¶</a></h2>
<p>When memory is allocated using <a class="reference external" href="http://en.cppreference.com/mwiki/index.php?search=operator new">operator new</a>,
eventually it must be recovered using <a class="reference external" href="http://en.cppreference.com/mwiki/index.php?search=operator delete">operator delete</a>.
When only a few lines of code are requesting memory,
this is not a major problem.
However, real world programs often request hundreds or thousands
of blocks of memory.
Keeping track of all this memory and when it should be freed can be labor intensive.
Moreover, the consequences of an error are high: program crashes or corrupted data.</p>
<p>Many languages, such as Java, Python, Ruby, and JavaScript take this problem
completely out of the hands of programmers.
In these languages, memory is never explicitly deleted by the program.
Rather it is managed by a <a class="reference internal" href="../glossary.html#term-garbage-collection"><span class="xref std std-term">garbage collector</span></a>,
which is responsible for cleaning up after the program
(removing its <a class="reference internal" href="../glossary.html#term-garbage"><span class="xref std std-term">garbage</span></a>).</p>
<p>C++ does not provide a garbage collection mechanism by default.
Given that memory management is such a problem,
does the STL provide any resources to help solve it?</p>
<p>Yes.</p>
<p>The C++ Standard Template Library provides a family of classes to help solve these problems.
They are all contained in the header <code class="docutils literal notranslate"><span class="pre">&lt;memory&gt;</span></code>
and are defined as templates so that they can point to objects of any type.</p>
<p>Smart pointers are classes that behave like <em>raw</em> pointers but also manage objects
created with <code class="docutils literal notranslate"><span class="pre">new</span></code>,
so that you don’t have to worry about when and whether to delete them.
Smart pointers are declared on the <a class="reference internal" href="../glossary.html#term-stack"><span class="xref std std-term">stack</span></a> and
automatically delete the encapsulated object when the smart pointer goes out of scope.
The smart pointer is defined in such a way that it can be used
syntactically almost exactly like a raw pointer.</p>
<p>One of the earliest so-called ‘smart pointers’ was <code class="docutils literal notranslate"><span class="pre">auto_ptr</span></code>.
Much online documentation and many text books still refer to and recommend <code class="docutils literal notranslate"><span class="pre">auto_ptr</span></code>.
The <code class="docutils literal notranslate"><span class="pre">auto_ptr</span></code> function was officially deprecated in C++11 and removed in C++17.
Generally, where old texts refer to <code class="docutils literal notranslate"><span class="pre">auto_ptr</span></code>, use <code class="docutils literal notranslate"><span class="pre">unique_ptr</span></code> instead.</p>
<div class="section" id="class-std-unique-ptr">
<h3><span class="section-number">5.2.1.1. </span>Class <code class="docutils literal notranslate"><span class="pre">std::unique_ptr</span></code><a class="headerlink" href="#class-std-unique-ptr" title="Permalink to this headline">¶</a></h3>
<p>A <a class="reference external" href="http://en.cppreference.com/mwiki/index.php?search=std::unique_ptr">std::unique_ptr</a> is a so-called ‘smart pointer’ that owns and manages another object through a pointer
and disposes of that object when the <code class="docutils literal notranslate"><span class="pre">unique_ptr</span></code> goes out of scope.
A <code class="docutils literal notranslate"><span class="pre">unique_ptr</span></code> is a very lightweight wrapper around a pointer.
The basic syntax is:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// older C++11 syntax</span>
<span class="c1">// clunky and repetitive</span>
<span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="kt">int</span><span class="p">);</span>

<span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>       <span class="c1">// C++14 adds make_unique</span>
</pre></div>
</div>
<p>In each example, both <code class="docutils literal notranslate"><span class="pre">p1</span></code> and <code class="docutils literal notranslate"><span class="pre">p2</span></code> are unique pointers that ‘own’ an <code class="docutils literal notranslate"><span class="pre">int*</span></code>.
Our earlier examples can be changed to:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"></span>
<span class="k">struct</span> <span class="nc">Point</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="k">auto</span>                 <span class="n">p3</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>       <span class="c1">// less redundant</span>

  <span class="c1">// array examples</span>
  <span class="c1">// unique pointers to arrays of 5 elements</span>
  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">[]</span><span class="o">&gt;</span> <span class="n">p4</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span>
  <span class="k">auto</span>                   <span class="n">p5</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

  <span class="c1">// user define types are no different</span>
  <span class="k">auto</span> <span class="n">pt_x</span>   <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="p">();</span>    <span class="c1">// one Point*</span>
  <span class="k">auto</span> <span class="n">points</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Point</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="c1">// array of 3 Point*</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Once declared, a unique pointer can be manipulated using the same syntax as a raw pointer.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">p</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="p">();</span>
<span class="c1">// modify Point coordinates and print</span>
<span class="n">p</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="n">p</span><span class="o">-&gt;</span><span class="n">y</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39; &#39;</span> <span class="o">&lt;&lt;</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>

<span class="c1">// this is an error</span>
<span class="c1">// std::cout &lt;&lt; p.x &lt;&lt; &#39; &#39; &lt;&lt; p.y &lt;&lt; &#39;\n&#39;;</span>
</pre></div>
</div>
<p>What makes a <code class="docutils literal notranslate"><span class="pre">unique_ptr</span></code> <em>unique</em>?</p>
<p>An object stored within a unique pointer <strong>uniquely owns</strong> its pointer.
In other words, an object is ‘owned’ by exactly one unique_ptr.
Unlike raw pointers, a unique pointer cannot be copied or assigned to another variable,
even another <code class="docutils literal notranslate"><span class="pre">unique</span> <span class="pre">pointer</span></code>.</p>
<p>No two unique pointers can ever contain the same raw pointer value.
This solves the ‘double delete’ problem if both go out of scope.
The result is that some operations you <strong>can</strong> perform on raw pointers
are not allowed on <code class="docutils literal notranslate"><span class="pre">unique_ptr</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">x</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="n">y</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">};</span>     <span class="c1">// error - copy construction not allowed</span>

<span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="n">z</span><span class="p">;</span>           <span class="c1">// new empty (nullptr)</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">z</span><span class="p">)</span> <span class="p">{</span>                            <span class="c1">// check if z != nullptr</span>
  <span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>                            <span class="c1">// error - copy assignment not allowed</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Although copying unique pointers is not allowed,
you can <a class="reference external" href="http://en.cppreference.com/mwiki/index.php?search=unique_ptr::release()">unique_ptr::release()</a> the pointer and assign it to a
raw pointer,
or transfer ownership to a different <code class="docutils literal notranslate"><span class="pre">unique_ptr</span></code>.</p>
<hr class="docutils" />
<div class="admonition-more-to-explore admonition">
<p class="admonition-title">More to Explore</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.mycodeschool.com">MyCodeSchool</a> video:
<a class="reference external" href="https://www.youtube.com/watch?v=_8-ht2AKyH4&amp;list=PL2_aWCzGMAwLZp6LMUKI3cc7pgGsasm2_&amp;index=12">Pointers and dynamic memory: stack vs heap</a></p></li>
<li><p><a class="reference external" href="https://isocpp.org/wiki/faq/freestore-mgmt">Free-store managment FAQ</a></p></li>
<li><p>From: cppreference.com:</p>
<ul>
<li><p><a class="reference external" href="http://en.cppreference.com/w/cpp/language/new">Operator new</a> and
<a class="reference external" href="http://en.cppreference.com/w/cpp/language/delete">delete</a>.</p></li>
<li><p><a class="reference external" href="http://en.cppreference.com/w/cpp/memory/unique_ptr">unique_ptr</a> and
<a class="reference external" href="http://en.cppreference.com/w/cpp/memory/unique_ptr/make_unique">make_unique</a>.</p></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>


  <div id=scprogresscontainer>
    You have attempted <span id=scprogresstotal></span> of <span id=scprogressposs></span> activities on this page <div id="subchapterprogress"></div>
  </div>
  
      
<ul>
  <li id="relations-prev" style="opacity:0.4" onmouseover="mouseOverPrev()" onmouseout="mouseOutPrev()"class="navLink" title='Previous Section - 5.1. Pointers' data-toggle="tooltip">
    <a href="pointers.html" aria-label="5.1. Pointers">
        <div style="background-color: white; border-style:solid; border-color:lightgrey; border-width:2px; width:100px; height:50px">
            <i class='prevNav glyphicon glyphicon-chevron-left'  style="top:50%; transform:translateY(-50%)translateX(-50%); left: 50%; color:black;"></i>
        </div>
    </a>
  </li>
</ul>

  
<ul>
  <li id="relations-next" style="opacity:0.4" onmouseover="mouseOverNext()" onmouseout="mouseOutNext()" class="navLink" title='Next Section - 5.3. Pointer debugging' data-toggle="tooltip" >
    <a href="valgrind.html" aria-label="5.3. Pointer debugging">
      <div style="background-color: white; border-style:solid; border-color:lightgrey; border-width:2px; width:100px; height:50px">
          <i id="relationsNextIcon" class='nextNav glyphicon glyphicon-chevron-right' style="top:50%; transform:translateY(-50%)translateX(-50%); left: 50%; color:black; "></i>
      </div>
    </a>
  </li>
</ul>

<script type="text/javascript">

  $('#relations-prev').tooltip({'placement':'right', 'selector': '', 'delay': { show: 100, hide: 50}});
  $('#relations-next').tooltip({'placement':'left', 'selector': '', 'delay': { show: 100, hide: 50}});

</script>

<script>
	function mouseOverPrev() {
		document.getElementById("relations-prev").style.opacity=1;
	}

	function mouseOutPrev() {
		document.getElementById("relations-prev").style.opacity=0.4;
	}
	function mouseOverNext() {
		document.getElementById("relations-next").style.opacity=1;
	}

	function mouseOutNext() {
		document.getElementById("relations-next").style.opacity=0.4;
	}
</script>
  
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      
      | <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017-2020 Dave Parillo.
      Created using <a href="http://runestoneinteractive.org/">Runestone</a> 5.5.5.
    </p>
  </div>
</footer>




<script> getSwitch(); </script>


  </body>
</html>