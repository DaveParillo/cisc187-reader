<!-- ****************************************
     |docname| - main template for this theme
     **************************************** -->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>14.5. Priority queues &#8212; CISC 187 Course Reader Overview</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/matrixeq.css?v=58BC228F" />
    <link rel="stylesheet" type="text/css" href="../_static/CodeChat.css" />
    <link rel="stylesheet" type="text/css" href="../_static/webgldemo.css?v=B36B48D" />
    <link rel="stylesheet" type="text/css" href="../_static/webglinteractive.css?v=910DF1E1" />
    <link rel="stylesheet" type="text/css" href="../_static/accessibility.css?v=50109A2C" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/637.0fa6cababf056764.css?v=F9484CEF" />
    <link rel="stylesheet" type="text/css" href="../_static/runestone.3eb60bc006ae9a54.css?v=3A5A250C" />



    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/matrixeq.js?v=D64CFA5A"></script>
    <script src="../_static/animationbase.js?v=A043C3A7"></script>
    <script src="../_static/html4css1.css?v=4533ACD3"></script>
    <script src="../_static/webglinteractive.js?v=2B768384"></script>
    <script src="../_static/FileSaver.min.js?v=8408C997"></script>
    <script src="../_static/runtime.66b619f51b746382.bundle.js?v=C3F69EE5"></script>
    <script src="../_static/637.d54be67956c5c660.bundle.js?v=915B1670"></script>
    <script src="../_static/runestone.ecc6dff5cad8b815.bundle.js?v=AE959292"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://media.ethicalads.io/media/client/ethicalads.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="14.6. The set class" href="set.html" />
    <link rel="prev" title="14.3. Binary Search Tree iterators" href="bst-iterator.html" />


<link rel="shortcut icon" href="/cisc187-reader/static/favicon.ico" type="image/ico" />



<link rel="canonical" href="https://{{canonical_host}}{{new_server_prefix}}/books/published/{{base_course}}/{{pagepath}}" />


<script>
  eBookConfig = {};
  
    eBookConfig.useRunestoneServices = false;
    eBookConfig.host = 'https://daveparillo.github.io/cisc187-reader/' || 'http://127.0.0.1:8000';
    eBookConfig.app = eBookConfig.host+'/cisc187-reader';
    eBookConfig.course = 'cisc187-reader';
    eBookConfig.basecourse = 'cisc187-reader';
    eBookConfig.isLoggedIn = false;
    eBookConfig.enableCompareMe = eBookConfig.useRunestoneServices;
    eBookConfig.new_server_prefix = '';
  
  eBookConfig.ajaxURL = eBookConfig.app+'/ajax/';
  eBookConfig.logLevel = 0;
  eBookConfig.loginRequired = false;
  eBookConfig.build_info = "unknown";
  eBookConfig.python3 = true;
  eBookConfig.acDefaultLanguage = 'cpp' ? 'cpp' : 'python'
  eBookConfig.runestone_version = '6.6.2';
  eBookConfig.jobehost = 'https://delicate-frost-8843.fly.dev';
  eBookConfig.proxyuri_runs = '/jobe/index.php/restapi/runs/';
  eBookConfig.proxyuri_files = '/jobe/index.php/restapi/files/';
  eBookConfig.enable_chatcodes = false ? false : false;
  eBookConfig.enableScratchAC = true;

</script>

<!-- Ad Serving Headers Only serve ads to Anonymous Users -->



  </head><body>


<!-- Begin navbar -->
<div id="navbar" class="navbar navbar-default navbar-fixed-top" role="navigation">

  <div class="container">

    <div class="navbar-header">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type='button' class='navbar-toggle' data-toggle="collapse" data-target=".navbar-ex1-collapse" aria-label="navbar toggle">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div>
        
        
          <div class="brand-logo"><img src="../_static/img/RAIcon.png" alt=""></div>
        
        <a class="navbar-brand" href="../index.html" aria-label="index-page">
          
          cisc187-reader
        </a>
      </div>
    </div>



    <div class="navbar-collapse collapse navbar-ex1-collapse">
      <ul class="nav navbar-nav navbar-right" >

        <li class="divider-vertical"></li>

        <!-- social media dropdown -->
        <!-- end social media dropdown -->

        <li class="divider-vertical"></li>
        <!-- search dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-search" style='opacity:0.9;'><span class="visuallyhidden" aria-label="Search">Search</span></i>
          </a>
          <ul class='dropdown-menu'>
            
                <li><a href='../index.html' aria-label="index-page">Table of Contents</a></li>
            
            <li><a href='../genindex.html'>Book Index</a></li>
            <li class="divider"></li>
            <li style="width: 240px;">
              <form class="navbar-search" style="margin:10px;" action="../search.html" method="get">
                <div class="input-group">
                  <input type="text" class="form-control" name="q" placeholder="Search this book" />
                  <span class="input-group-btn">
                    <button class="btn btn-primary" style="margin:0;" type="submit">
                      <i class="glyphicon glyphicon-search"></i>
                    </button>
                  </span>
                </div><!-- /input-group -->
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
            </li>
          </ul>
        </li>
        <!-- end search dropdown -->

        <li class="divider-vertical"></li>

        
        <li class="divider-vertical"></li>
        <!-- <li id="scratch_ac_link"><a href="javascript:ACFactory.toggleScratchActivecode()">Scratch ActiveCode</a></li> -->

        <!-- <li class="dropdown">             -->
          <li id="scratch_ac_link" class="dropdown"><a href="javascript:runestoneComponents.popupScratchAC()">
              <i class="glyphicon glyphicon-pencil" style="opacity:0.9;"><span class="visuallyhidden" aria-label="Scratch Activecode" >Scratch Activecode</span></i></a></li>
        <!-- </li> -->

        <li class="divider-vertical"></li>

        
      </ul>

      <ul class="nav navbar-nav">
        <li class="divider-vertical"></li>
        
          
          <li class="divider-vertical"></li>
        
        <!-- 
          
  <li id="relations-prev" title="Previous Chapter - <span class="section-number">14.3. </span>Binary Search Tree iterators" data-toggle="tooltip">
    <a href="bst-iterator.html" >
      <i class='glyphicon glyphicon-backward' style='opacity:0.9;'></i>
    </a>
  </li>
  
  <li id="relations-next" title='Next Chapter - <span class="section-number">14.6. </span>The set class' data-toggle="tooltip" >              
    <a href="set.html" >
        <i class='glyphicon glyphicon-forward' style='opacity:0.9;'></i>
    </a>
  </li>
  <li class="divider-vertical"></li>

<script>
  opts = {'placement':'bottom',
          'selector': '',
          'delay': { show: 100, hide: 50}
         };

  window.addEventListener('load', (event) => {
    $('#relations-prev').tooltip(opts);
    $('#relations-next').tooltip(opts);
  });
</script>
        -->
        
          <li></li>
        
      </ul>
      </div> <!-- navbar-collapse -->
    </div> <!-- navbar -->
  </div> <!-- container -->


<div class="container" id="continue-reading"></div>

<div class="container" id="main-content" role="main">

<!-- Ad Serving for Runestone Campaign -->


  
  <section id="priority-queues">
<span id="index-0"></span><h1><span class="section-number">14.5. </span>Priority queues<a class="headerlink" href="#priority-queues" title="Permalink to this heading">¶</a></h1>
<p>If we have a collection of elements that carry a “score”,
then how can we find and remove the element with the smallest (or largest) score?
What if new elements may be added at any time?</p>
<p>This collection is called a <a class="reference internal" href="../glossary.html#term-priority-queue"><span class="xref std std-term">priority queue</span></a> because:</p>
<ul class="simple">
<li><p>Like <a class="reference external" href="https://en.cppreference.com/w/cpp/container/queue">std::queue</a>, it is used to simulate objects waiting in line.</p></li>
<li><p>But instead of FIFO, the processing order is determined by the object “priority” or score.</p></li>
</ul>
<p>Like <a class="reference external" href="https://en.cppreference.com/w/cpp/container/stack">std::stack</a> and <a class="reference external" href="https://en.cppreference.com/w/cpp/container/queue">std::queue</a>,
<a class="reference external" href="https://en.cppreference.com/w/cpp/container/priority_queue">std::priority_queue</a> is an adapter that works on an underlying sequential container,
which must provide random-access iterators (vector or deque). For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">event</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">event_queue</span><span class="p">;</span>
</pre></div>
</div>
<p>Priority queues are often used to manage scheduling.
The classic example of a priority queue is an emergency room.
Patients are not served in the order they arrive, but in order of severity.</p>
<p>In a software application, if we wanted to simulate urban traffic,
we might create a series of events, some of which spawn other future events:</p>
<ul class="simple">
<li><p>Simulated traffic light need an event for the next change.  When a light
changes to red, we schedule a change event to green some number of seconds
later. When a light changes to green, we schedule a change-to-yellow event
some time a little later, and so on.</p></li>
<li><p>Parking lots and garages might be simulated as objects that, at random time
intervals, toss a new car out on to the street in front of the lot or garage.
The car-generation interval might vary with the time of day (e.g., at 5:00PM,
when everyone is leaving work, the interval between cars leaving each garage
would be reduced).</p></li>
<li><p>Each moving car on the street would have an event associated with the time it
needs to reach the next intersection along its path. When it reaches the
intersection, we schedule a new event for the intersection after that, and so
on.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">while</span><span class="w"> </span><span class="o">(</span>simulation<span class="w"> </span>has<span class="w"> </span>not<span class="w"> </span>ended<span class="o">)</span>
<span class="w">   </span>get<span class="w"> </span>next<span class="w"> </span>event<span class="w"> </span>from<span class="w"> </span>event_queue
<span class="w">   </span>trigger<span class="w"> </span>event
end<span class="w"> </span><span class="k">while</span>
</pre></div>
</div>
<p>In this example, the ‘priority’ value is time.
Regardless of when an event is sent, we want the events to occur in their correct time order.</p>
<p>Although ‘queue` is in the name, a queue is not a good starting point
for a priority queue implementation.
However, there is a data type perfectly suited to this task – a heap.
In fact, heaps are used to implement priority queues so often that the terms
are often used interchangeably.</p>
<section id="heaps">
<span id="index-1"></span><h2><span class="section-number">14.5.1. </span>Heaps<a class="headerlink" href="#heaps" title="Permalink to this heading">¶</a></h2>
<p>A <a class="reference internal" href="../glossary.html#term-heap"><span class="xref std std-term">heap</span></a> is a special tree-like data structure.
There are many types of heaps, however, in this chapter,
we will discuss only <em>binary heaps</em>.
In this section, we will refer to binary heaps merely as heaps.
A heap may be a binary tree, but it is <strong>not</strong> a binary search tree.
Heaps have two key attributes:</p>
<ul>
<li><p>The underlying tree must be <strong>complete</strong></p></li>
<li><p>The order of elements must obey the <em>heap property</em></p>
<p>For a <a class="reference internal" href="../glossary.html#term-min-heap"><span class="xref std std-term">min heap</span></a> a parent element must be <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code> all its children.</p>
<p>For a <a class="reference internal" href="../glossary.html#term-max-heap"><span class="xref std std-term">max heap</span></a> a parent element must be <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code> all its children.</p>
</li>
</ul>
<p>One of the side-effects of heap is that the minimum (or maximum)
value can always be found at the tree root.</p>
<div align="center" class="align-center"><div class="graphviz"><img src="../_images/graphviz-49e83788bc37968b19d265fa3c85fae5d6e65582.png" alt="An example min heap" class="graphviz" /></div>
</div>
<p>We can show that a complete binary tree of height <span class="math notranslate nohighlight">\(h\)</span> has between
<span class="math notranslate nohighlight">\(2h\)</span> and <span class="math notranslate nohighlight">\(2(h+1) − 1\)</span> nodes.
This implies that the height of a complete binary tree is <span class="math notranslate nohighlight">\(\lfloor \log N \rfloor\)</span>,
which results in <span class="math notranslate nohighlight">\(O(\log N)\)</span> performance.</p>
<p>Although logically a heap is a tree-like data structure,
because the tree must be complete, it fits easily into an array or vector.
It is very common to use an array for the <em>physical implementation</em> of a heap,
since it is much more efficient than a general purpose tree
bound together with pointers.
For a tree of height <span class="math notranslate nohighlight">\(2^h - 1\)</span>:</p>
<ul class="simple">
<li><p>The parent of a node <cite>i</cite> is located at index <span class="math notranslate nohighlight">\(\lfloor \frac{i}{2} \rfloor\)</span></p></li>
<li><p>The left child of a node <cite>i</cite> is located at index <span class="math notranslate nohighlight">\(2i\)</span></p></li>
<li><p>The right child of a node <cite>i</cite> is located at index <span class="math notranslate nohighlight">\(2i + 1\)</span></p></li>
</ul>
<p>To get our math to work out nicely, we place the root node at index position 1.
This storage location won’t go to waste – it is used when we remove nodes from the
tree and maintaining the heap property is required.</p>
<p>The array representation of the min heap is:</p>
<div align="center" class="align-center"><div class="graphviz"><img src="../_images/graphviz-5c0696a0a42c23d1937823276dceb099c58646f1.png" alt="Array representation of a min heap" class="graphviz" /></div>
</div>
<p>Depending on the implementation,
the backing store may or may not have extra storage.</p>
<p>The heap interface can be implemented as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span>
<span class="w">       </span><span class="k">class</span><span class="w"> </span><span class="nc">Container</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
<span class="w">       </span><span class="k">class</span><span class="w"> </span><span class="nc">Compare</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">greater</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Container</span><span class="o">::</span><span class="n">value_type</span><span class="o">&gt;&gt;</span>
<span class="w">   </span><span class="c1">// require T is comparable</span>
<span class="w">   </span><span class="k">class</span><span class="w"> </span><span class="nc">binary_heap</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">     </span><span class="k">public</span><span class="o">:</span>
<span class="w">       </span><span class="k">using</span><span class="w"> </span><span class="n">value_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">;</span>
<span class="w">       </span><span class="k">using</span><span class="w"> </span><span class="n">value_compare</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Compare</span><span class="p">;</span>
<span class="w">       </span><span class="k">static_assert</span><span class="p">((</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">Container</span><span class="o">::</span><span class="n">value_type</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">),</span>
<span class="w">         </span><span class="s">&quot;heap type must match underlying container value type&quot;</span><span class="w"> </span><span class="p">);</span>

<span class="w">       </span><span class="n">binary_heap</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>

<span class="w">       </span><span class="c1">// Construct a heap from an unsorted container</span>
<span class="w">       </span><span class="k">explicit</span><span class="w"> </span><span class="n">binary_heap</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Container</span><span class="o">&amp;</span><span class="w"> </span><span class="n">items</span><span class="p">);</span>
<span class="w">       </span><span class="k">explicit</span><span class="w"> </span><span class="n">binary_heap</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">initializer_list</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="p">)</span>

<span class="w">       </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">void</span><span class="w">     </span><span class="n">clear</span><span class="p">()</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>
<span class="w">       </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w">     </span><span class="nf">empty</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>
<span class="w">       </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w">      </span><span class="nf">full</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>
<span class="w">       </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">size_t</span><span class="w">    </span><span class="nf">size</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>
<span class="w">       </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">front</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>

<span class="w">       </span><span class="kt">void</span><span class="w"> </span><span class="nf">pop</span><span class="p">();</span>
<span class="w">       </span><span class="kt">void</span><span class="w"> </span><span class="nf">push</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>

<span class="w">     </span><span class="k">private</span><span class="o">:</span>
<span class="w">       </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">       </span><span class="n">Container</span><span class="w"> </span><span class="n">heap_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">T</span><span class="p">{}};</span>

<span class="w">       </span><span class="kt">void</span><span class="w"> </span><span class="nf">percolate_down</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">hole</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>
<span class="w">       </span><span class="kt">void</span><span class="w"> </span><span class="nf">build_heap</span><span class="p">()</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>
<span class="w">       </span><span class="kt">void</span><span class="w"> </span><span class="nf">percolate_up</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>

<span class="w">   </span><span class="p">};</span>
</pre></div>
</div>
<p>The defining operations of a heap are:</p>
<dl>
<dt>front</dt><dd><p>Peek at the heap root element.</p>
</dd>
<dt>pop</dt><dd><p>Remove a value while maintaining the heap property.</p>
<p>Calls <code class="docutils literal notranslate"><span class="pre">percolate_down</span></code> to perform the work.</p>
</dd>
<dt>Constructors</dt><dd><p>Creates a new underlying container of the container adaptor from a variety of data sources.</p>
<p>Calls <code class="docutils literal notranslate"><span class="pre">build_heap</span></code> to ensure the heap property satisfied when
construction is complete.</p>
</dd>
<dt>push</dt><dd><p>Add a new value to the heap, while maintaining the heap property.</p>
<p>Calls <code class="docutils literal notranslate"><span class="pre">percolate_up</span></code> to perform the work.</p>
</dd>
</dl>
<p>In this implementation, any container that implements
<code class="docutils literal notranslate"><span class="pre">front()</span></code>, <code class="docutils literal notranslate"><span class="pre">push_back()</span></code>, and <code class="docutils literal notranslate"><span class="pre">pop_back()</span></code> are candidates
for the backing store. This example uses vector by default.
The Compare class allows the same class to function as either a min heap
(the default), or another comparison function.
Using <a class="reference external" href="https://en.cppreference.com/w/cpp/utility/functional/less">less</a> would transform the heap into a max heap.</p>
</section>
<section id="percolate-up">
<h2><span class="section-number">14.5.2. </span>Percolate up<a class="headerlink" href="#percolate-up" title="Permalink to this heading">¶</a></h2>
<p>When a new node is added to the heap, we initially use <code class="docutils literal notranslate"><span class="pre">push_back</span></code>
to append the new value to the ‘last’ open position in the tree (the hole).
At this point the tree is still complete, but the new value
is not in the correct position (except through some random stroke of luck).
So after the initial <code class="docutils literal notranslate"><span class="pre">push_back</span></code> the heap property is violated and
must be restored.</p>
<div align="center" class="align-center"><div class="graphviz"><img src="../_images/graphviz-4fda410c0e94b33840bad734d45ab7d265cce5c7.png" alt="Precolate up - no move needed" class="graphviz" /></div>
</div>
<p>If however, the new value is less then its parent, it must be moved into a
valid position.</p>
<div align="center" class="align-center"><div class="graphviz"><img src="../_images/graphviz-c202da0fe7c10303c730ce80171c2e697ac3b88f.png" alt="Percolate up - move needed" class="graphviz" /></div>
</div>
<p>First we swap the value at position ‘b’ with the value at position ‘e’:</p>
<div align="center" class="align-center"><div class="graphviz"><img src="../_images/graphviz-813889ad426a9715ddcc68e65a72510d0c1c8c74.png" alt="Percolate up - first move" class="graphviz" /></div>
</div>
<p>The value at position ‘d’ is still larger then ‘b’, so we are not done:</p>
<div align="center" class="align-center"><div class="graphviz"><img src="../_images/graphviz-e13b5f92fe572df6db2c4f0c4255c8629a82b3d2.png" alt="Percolate up - last move" class="graphviz" /></div>
</div>
<p>Now that ‘a’ is less than ‘b’ and all of the children of ‘b’
are greater than ‘b’, the heap property has been restored and we are done.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">percolate_up</span></code> function does all the hard work.
In truth, it is a fairly short function.
The algorithm outline is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>percolate_up<span class="w"> </span><span class="o">(</span>value<span class="o">)</span>
<span class="w">   </span>heap<span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="w"> </span>←<span class="w"> </span>value
<span class="w">   </span>hole<span class="w"> </span>←<span class="w"> </span>last<span class="w"> </span>position<span class="w"> </span><span class="k">in</span><span class="w"> </span>heap
<span class="w">   </span><span class="k">while</span><span class="w"> </span><span class="o">(</span>value<span class="w"> </span>&lt;<span class="w"> </span>parent_of_hole<span class="o">)</span>
<span class="w">      </span>move<span class="w"> </span>parent<span class="w"> </span>value<span class="w"> </span>to<span class="w"> </span>hole
<span class="w">      </span><span class="nb">set</span><span class="w"> </span>hole<span class="w"> </span>to<span class="w"> </span>parent<span class="w"> </span>position
<span class="w">   </span><span class="k">done</span><span class="w"> </span><span class="k">while</span>
<span class="w">   </span>move<span class="w"> </span>heap<span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="w"> </span>to<span class="w"> </span>heap<span class="o">[</span>hole<span class="o">]</span>
<span class="k">done</span><span class="w"> </span>percolate_up
</pre></div>
</div>
<p>The actual implementation is a lab exercise.</p>
<p>To implement <code class="docutils literal notranslate"><span class="pre">push</span></code> using <code class="docutils literal notranslate"><span class="pre">percolate_up</span></code>, we:</p>
<ul class="simple">
<li><p>Increase backing store capacity, if needed.</p></li>
<li><p>Push the value onto the end of the tree.</p></li>
<li><p>Increase the tree size by 1.</p></li>
<li><p>Percolate up from the last node in the tree.</p></li>
</ul>
</section>
<section id="percolate-down">
<h2><span class="section-number">14.5.3. </span>Percolate down<a class="headerlink" href="#percolate-down" title="Permalink to this heading">¶</a></h2>
<p>When we return a value from the top of the heap, we return the root node value.
We now have a hole that needs to be filled.
One approach is to move the last node in the heap to the root position
and then ‘percolate_down’ to push the value to its proper location in the tree.
This has a few of advantages;</p>
<ul class="simple">
<li><p>It maintains the completeness property of our tree</p></li>
<li><p>It is relatively straightforward to implement.
The same algorithm can be used independent of the tree structure
or any node value.</p></li>
</ul>
<p>Since this is a little more complicated than <code class="docutils literal notranslate"><span class="pre">percolate_up</span></code>,
the entire function is shown.
The main complication is that the current node might have 0 children, 1 child,
or 2 children, so we need to be careful that we don’t try to access the value of
non-existent children.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">percolate_down</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">hole</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">T</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">heap_</span><span class="p">[</span><span class="n">hole</span><span class="p">]);</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">child</span><span class="p">;</span><span class="w"> </span><span class="n">hole</span><span class="o">*</span><span class="mi">2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">size_</span><span class="p">;</span><span class="w"> </span><span class="n">hole</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hole</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">child</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">size_</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">heap_</span><span class="p">[</span><span class="n">child</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">heap_</span><span class="p">[</span><span class="n">child</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="o">++</span><span class="n">child</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">heap_</span><span class="p">[</span><span class="n">child</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tmp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">heap_</span><span class="p">[</span><span class="n">hole</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">heap_</span><span class="p">[</span><span class="n">child</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">heap_</span><span class="p">[</span><span class="n">hole</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A walk-through follows.
When we pop ‘a’ from the heap, we leave a space that must be filled
while maintaining the heap property.</p>
<div align="center" class="align-center"><div class="graphviz"><img src="../_images/graphviz-681b355293f75c4975df5bd96078e18eeb0a5fcf.png" alt="Percolate down" class="graphviz" /></div>
</div>
<p>Grab the last value in the tree, which may or may not be the largest value.
Move this value into the root position.
Since the largest value is in the root position, the heap property is no longer valid.
We have to restore the heap property by pushing this value down
until the heap property is restored.</p>
<p>We can achieve this by continually exchanging the smallest child value with the
current value until the heap property is restored.</p>
<div align="center" class="align-center"><div class="graphviz"><img src="../_images/graphviz-527a1afd80ceab7e062bbbd17117972842fdda67.png" alt="Percolate down" class="graphviz" /></div>
</div>
<p>The ‘j’ is still larger than ‘d’, so again, we exchange the two values.</p>
<div align="center" class="align-center"><div class="graphviz"><img src="../_images/graphviz-2dfe20c40ce455d9e587cca898d30883a2bf0dd7.png" alt="Percolate down" class="graphviz" /></div>
</div>
<p>When we check the left node, the value ‘j’ is less then ‘m’.
We can’t stop at this point, because this node has another child.
The ‘j’ is still larger than ‘i’, so we exchange values,
however this time we traverse the right sub tree.</p>
<div align="center" class="align-center"><div class="graphviz"><img src="../_images/graphviz-69edfe477bd0d0b509efdde30ea48b2953832c47.png" alt="Percolate down" class="graphviz" /></div>
</div>
<p>At this point, the node ‘j’ has no children, so we are done.</p>
<div align="center" class="align-center"><div class="graphviz"><img src="../_images/graphviz-dc1116099b619ea2fc0ba4c27bc0140fe0fffa32.png" alt="Percolate down" class="graphviz" /></div>
</div>
<p>To implement <code class="docutils literal notranslate"><span class="pre">pop</span></code> using <code class="docutils literal notranslate"><span class="pre">percolate_down</span></code>, we:</p>
<ul class="simple">
<li><p>Move the last tree node to the root.</p></li>
<li><p>Reduce the tree size by 1</p></li>
<li><p>Percolate down from the root node.</p></li>
</ul>
<p><strong>Build heap</strong></p>
<p>Frequently we want to create a binary heap from an existing collection
which could be the template type <code class="docutils literal notranslate"><span class="pre">Container</span></code> or an <code class="docutils literal notranslate"><span class="pre">initializer_list&lt;T&gt;</span></code> in
our example heap.
These constructors take <span class="math notranslate nohighlight">\(N\)</span> arbitrarily items and transforms them into a heap.
We could achieve this with <span class="math notranslate nohighlight">\(N\)</span> successive inserts.
Each insert will take <span class="math notranslate nohighlight">\(O(1)\)</span> average and <span class="math notranslate nohighlight">\(O(log N)\)</span> worst-case time,
the total running time of this algorithm would be <span class="math notranslate nohighlight">\(O(N)\)</span> average but <span class="math notranslate nohighlight">\(O(N log N)\)</span> worst-case.
Since this is a special instruction and there are no other operations intervening,
and we already know that the instruction can be performed in linear average time,
it is reasonable to expect that with reasonable care a linear time bound can be guaranteed.</p>
<p>The general algorithm is to place all the items into the tree in any order,
maintaining the structure property.
Then, if percolate_down(i) percolates down from node i, the buildHeap routine in Figure 6.14 can be used by the constructor to create a heap-ordered tree.</p>
<p>To implement <code class="docutils literal notranslate"><span class="pre">build_heap</span></code> using <code class="docutils literal notranslate"><span class="pre">percolate_down</span></code>, we:</p>
<ul class="simple">
<li><p>Copy all items from the source container or range into the heap backing store in any order.
As long no uninitialized values are present in the range <span class="math notranslate nohighlight">\(\left [ begin(), end() \right )\)</span>,
then the heap structure is maintained and only the heap order property needs work.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">percolate_down</span></code> starting from the heap midpoint and iterate down to the root node.</p></li>
</ul>
<p>The actual implementation of <code class="docutils literal notranslate"><span class="pre">build_heap</span></code> is a lab assignment.</p>
<hr class="docutils" />
<div class="admonition-more-to-explore admonition">
<p class="admonition-title">More to Explore</p>
<ul class="simple">
<li><p>The content on this page was adapted from
<a class="reference external" href="https://www.cs.odu.edu/~zeil/cs361/latest/Public/bst/index.html">Binary Search Trees</a>,
by Steven J. Zeil for his data structures course CS361.</p></li>
<li><p><a class="reference external" href="https://en.cppreference.com/w/cpp/container/priority_queue">std::priority_queue</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Heap_(data_structure)">Heap data structures</a></p></li>
</ul>
</div>
</section>
</section>


  

  <div id="scprogresscontainer">
    You have attempted <span id="scprogresstotal"></span> of <span id="scprogressposs"></span> activities on this page <div id="subchapterprogress" aria-label="Page progress"></div>
  </div>

  <ul role="navigation" class="nextprev-list nextprev-list" aria-label="Change page">
<li id="relations-prev" class="navLink" title='Previous Section - 14.3. Binary Search Tree iterators' data-toggle="tooltip">
  <a href="bst-iterator.html" aria-label="Previous - 14.3. Binary Search Tree iterators">
    <i class='prevNav glyphicon glyphicon-chevron-left'  style="top:50%; transform:translateY(-50%)translateX(-50%); left: 50%; color:black;"></i>
  </a>
</li>

  <li id="relations-next" class="navLink" title='Next Section - 14.6. The set class' data-toggle="tooltip" >
    <a href="set.html" aria-label="Next - 14.6. The set class">
      <i id="relationsNextIcon" class='nextNav glyphicon glyphicon-chevron-right' style="top:50%; transform:translateY(-50%)translateX(-50%); left: 50%; color:black; "></i>
    </a>
  </li>
</ul>

<script>
window.addEventListener('load', (event) => {
  $('#relations-prev').tooltip({'placement': 'right', 'delay': { show: 100, hide: 50}});
  $('#relations-next').tooltip({'placement': 'left', 'delay': { show: 100, hide: 50}});
});
</script>

</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      
      | <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017-2023 Dave Parillo.
      Created using <a href="http://runestoneinteractive.org/">Runestone</a> 6.6.2.
    </p>
  </div>
</footer>




<script>
  window.addEventListener('load', (event) => {
    runestoneComponents.getSwitch();
  });
</script>


  </body>
</html>